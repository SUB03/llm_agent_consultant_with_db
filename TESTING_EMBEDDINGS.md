# –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á DeepSeek
```bash
export DEEPSEEK_API_KEY="sk-your-api-key-here"
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker
```bash
docker compose up -d
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```bash
python3 test_embeddings.py
```

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫—Ä–∏–ø—Ç

### ‚úÖ –¢–µ—Å—Ç 1: DeepSeek API
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ API –∫–ª—é—á–∞
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —ç–º–±–µ–¥–¥–∏–Ω–≥
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 1024)

### ‚úÖ –¢–µ—Å—Ç 2: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è pgvector

### ‚úÖ –¢–µ—Å—Ç 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ FAQ
- –î–æ–±–∞–≤–ª—è–µ—Ç 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö FAQ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

### ‚úÖ –¢–µ—Å—Ç 4: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- –ò—â–µ—Ç –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º:
  - "–∫–∞–∫ –∫—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä" ‚Üí –Ω–∞–π–¥–µ—Ç "–æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
  - "—á–µ–º –º–æ–∂–Ω–æ –∑–∞–ø–ª–∞—Ç–∏—Ç—å" ‚Üí –Ω–∞–π–¥–µ—Ç "—Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã"
  - "–∫–æ–≥–¥–∞ –ø—Ä–∏–¥–µ—Ç –ø–æ—Å—ã–ª–∫–∞" ‚Üí –Ω–∞–π–¥–µ—Ç "–≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏"

### ‚úÖ –¢–µ—Å—Ç 5: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Ç–µ–∫—Å—Ç–æ–≤—ã–º –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º

### ‚úÖ –¢–µ—Å—Ç 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
- –í—ã–≤–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Python

```python
import os
from app.db.db import Database

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª—é—á
os.environ['DEEPSEEK_API_KEY'] = 'sk-xxxxx'

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
db = Database('postgresql://user:password@localhost:5434/web_assistant')

# 1. –ü–æ–ª—É—á–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥
embedding = db.get_embedding("–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?")
print(f"–†–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞: {len(embedding)}")
print(f"–ü–µ—Ä–≤—ã–µ 5 –∑–Ω–∞—á–µ–Ω–∏–π: {embedding[:5]}")

# 2. –î–æ–±–∞–≤–∏—Ç—å FAQ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–º
faq_id = db.add_knowledge(
    question="–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?",
    answer="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ",
    category="–ü–æ–∫—É–ø–∫–∏"
)
print(f"FAQ –¥–æ–±–∞–≤–ª–µ–Ω —Å ID: {faq_id}")

# 3. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
results = db.search_knowledge("–∫–∞–∫ –∫—É–ø–∏—Ç—å", use_vector=True)
for kb in results:
    print(f"- {kb.question}")

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥ –≤ –ë–î
from app.db.db import KnowledgeBase
session = db.get_session()
kb = session.query(KnowledgeBase).first()
if kb.embedding:
    print(f"–≠–º–±–µ–¥–¥–∏–Ω–≥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {len(kb.embedding)} –∏–∑–º–µ—Ä–µ–Ω–∏–π")
session.close()
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ SQL

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
docker compose exec vector_db psql -U user -d web_assistant

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector
\dx vector

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d knowledge_base

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
SELECT id, question, 
       CASE WHEN embedding IS NULL THEN '–ù–ï–¢' ELSE '–ï–°–¢–¨' END as has_embedding
FROM knowledge_base;

# –†–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–∞
SELECT id, question, array_length(embedding, 1) as embedding_size
FROM knowledge_base
WHERE embedding IS NOT NULL;

# –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (–ø—Ä–∏–º–µ—Ä)
-- –ù—É–∂–µ–Ω —ç–º–±–µ–¥–¥–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç DeepSeek API
-- SELECT * FROM knowledge_base 
-- ORDER BY embedding <=> '[0.1, 0.2, ...]'::vector 
-- LIMIT 5;
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ cURL

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥ –æ—Ç DeepSeek
curl https://api.deepseek.com/v1/embeddings \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $DEEPSEEK_API_KEY" \
  -d '{
    "model": "deepseek-chat",
    "input": "–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?",
    "encoding_format": "float"
  }'

# –û—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ –∏–∑ 1024 —á–∏—Å–µ–ª:
# {
#   "data": [{
#     "embedding": [0.123, -0.456, 0.789, ..., 0.321],
#     "index": 0
#   }],
#   ...
# }
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "DEEPSEEK_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª—é—á
export DEEPSEEK_API_KEY="sk-your-key"

# –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ .env
echo 'DEEPSEEK_API_KEY=sk-your-key' >> .env

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
echo $DEEPSEEK_API_KEY
```

### –û—à–∏–±–∫–∞: "CREATE EXTENSION vector"

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
docker compose exec vector_db psql -U user -d web_assistant

# –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
CREATE EXTENSION IF NOT EXISTS vector;

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
\dx
```

### –û—à–∏–±–∫–∞: "Connection refused"

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose down -v
docker compose up -d
```

### –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. ‚úÖ API –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. ‚úÖ –ï—Å—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ DeepSeek
3. ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω API (https://api.deepseek.com)
4. ‚úÖ –í –ë–î –µ—Å—Ç—å –ø–æ–ª–µ `embedding` —Ç–∏–ø–∞ `vector(1024)`

### –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
from app.db.db import Database, KnowledgeBase

db = Database()
session = db.get_session()

count_with_embedding = session.query(KnowledgeBase).filter(
    KnowledgeBase.embedding.isnot(None)
).count()

total = session.query(KnowledgeBase).count()

print(f"FAQ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏: {count_with_embedding} –∏–∑ {total}")
session.close()

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0 –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
–¢–ï–°–¢ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ DeepSeek API
‚úì API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω: sk-1234567...xyz
‚úì –≠–º–±–µ–¥–¥–∏–Ω–≥ –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!
  –†–∞–∑–º–µ—Ä: 1024 –∏–∑–º–µ—Ä–µ–Ω–∏–π
  –ü–µ—Ä–≤—ã–µ 5 –∑–Ω–∞—á–µ–Ω–∏–π: [0.123, -0.456, 0.789, 0.234, -0.567]

–¢–ï–°–¢ 4: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
üîç –ü–æ–∏—Å–∫: '–∫–∞–∫ –∫—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä'
   –ù–∞–π–¥–µ–Ω–æ: 2 —Ä–µ–∑—É–ª—å—Ç–∞—Ç(–æ–≤)
   1. –ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ?
   2. –ö–∞–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ?
```

### –ü–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
–¢–ï–°–¢ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ DeepSeek API
‚ùå DEEPSEEK_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!

–¢–ï–°–¢ 4: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
üîç –ü–æ–∏—Å–∫: '–∫–∞–∫ –∫—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä'
   –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
   (fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫)
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

```python
import numpy as np

# –î–≤–∞ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–∞
v1 = db.get_embedding("–ö–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?")
v2 = db.get_embedding("–ö–∞–∫ –∫—É–ø–∏—Ç—å —Ç–æ–≤–∞—Ä?")

# –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–º–µ–Ω—å—à–µ = –±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏)
from numpy.linalg import norm
cosine_similarity = np.dot(v1, v2) / (norm(v1) * norm(v2))
print(f"–°—Ö–æ–∂–µ—Å—Ç—å: {cosine_similarity:.4f}")
# –û–∂–∏–¥–∞–µ—Ç—Å—è > 0.8 –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

# –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–∞
v3 = db.get_embedding("–ö–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –≤ –ú–æ—Å–∫–≤–µ?")
cosine_similarity2 = np.dot(v1, v3) / (norm(v1) * norm(v3))
print(f"–°—Ö–æ–∂–µ—Å—Ç—å (—Ä–∞–∑–Ω—ã–µ): {cosine_similarity2:.4f}")
# –û–∂–∏–¥–∞–µ—Ç—Å—è < 0.5 –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º
```

### Benchmark –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
import time

# –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
start = time.time()
results = db.search_knowledge("–∑–∞–∫–∞–∑", use_vector=False)
text_time = time.time() - start

# –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
start = time.time()
results = db.search_knowledge("–∑–∞–∫–∞–∑", use_vector=True)
vector_time = time.time() - start

print(f"–¢–µ–∫—Å—Ç–æ–≤—ã–π: {text_time:.4f} —Å–µ–∫")
print(f"–í–µ–∫—Ç–æ—Ä–Ω—ã–π: {vector_time:.4f} —Å–µ–∫")
```

## –°–º. —Ç–∞–∫–∂–µ

- [VECTOR_SEARCH_GUIDE.md](VECTOR_SEARCH_GUIDE.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- [DATABASE_GUIDE.md](DATABASE_GUIDE.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ë–î
- [test_embeddings.py](test_embeddings.py) - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
